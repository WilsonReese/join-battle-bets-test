<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Join my Battle Bets League</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Keep preview identical to your current /join -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Join my Battle Bets League!" />
  <meta property="og:description" content="The world's first app for simulated sports betting leagues. Fake money. Real fun." />
  <meta property="og:image" content="https://cdn.prod.website-files.com/6797de532bc3b2461a7039ff/6889824bd4161c300cd7753b_social-sharing.png" />
  <meta property="og:url" content="https://join.battlebets.app/join" />
  <meta name="robots" content="noindex" />

  <style>
    :root { color-scheme: dark light; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0b1420; color:#fff; margin:0; min-height:100dvh; display:grid; place-items:center; padding:24px; }
    .card { width:100%; max-width:560px; padding:24px; background:#132235; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25) }
    h1 { margin:0 0 8px }
    p { margin:8px 0 }
    .btn { display:block; text-align:center; padding:14px 16px; border-radius:12px; text-decoration:none; font-weight:600; margin:12px 0 }
    .btn-primary { background:#3bd17f; color:#0b1420 }
    .btn-ghost { background:transparent; border:1px solid #3bd17f; color:#3bd17f }
    .muted { opacity:.8; font-size:14px }
  </style>
</head>
<body>
  <div class="card">
    <h1>Open Battle Bets</h1>
    <p>We’ll open the app with your invite.</p>

    <a id="openBtn" class="btn btn-primary" href="#">Open Battle Bets</a>
    <a id="downloadBtn" class="btn btn-ghost" href="#">Download Battle Bets</a>

    <p class="muted">If you don’t have the app, the App Store will open.</p>
  </div>

  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      const poolId = params.get('pool_id') || '';
      const token  = params.get('token')  || '';

      // 1) Open the app via custom scheme that your app already handles: path = "join"
      const SCHEME_JOIN = `battlebets://join?pool_id=${encodeURIComponent(poolId)}&token=${encodeURIComponent(token)}`;

      // 2) Store URL + fallback if store is blocked
      const APP_STORE = 'https://apps.apple.com/us/app/battle-bets/id6738606749';
      const SITE_FALLBACK = 'https://battlebets.app';

      // Open: try scheme, then App Store fallback if the app doesn't foreground
      document.getElementById('openBtn').onclick = function (e) {
        e.preventDefault();
        const t = Date.now();

        // Attempt to open the app
        window.location.href = SCHEME_JOIN;

        // If the page is still visible after ~1.2s, assume app didn't open -> App Store
        setTimeout(function () {
          if (!document.hidden && Date.now() - t > 1100) {
            window.location.href = APP_STORE;
          }
        }, 1200);
      };

      // Download: direct to App Store; if Store is blocked, fall back to website
      document.getElementById('downloadBtn').onclick = function (e) {
        e.preventDefault();
        const t = Date.now();
        window.location.href = APP_STORE;
        setTimeout(function () {
          if (!document.hidden && Date.now() - t > 1100) {
            window.location.href = SITE_FALLBACK;
          }
        }, 1200);
      };
    })();
  </script>
</body>
</html>
